"use strict";(self.webpackChunkdocs_sinpom=self.webpackChunkdocs_sinpom||[]).push([[6861],{1256:(e,d,s)=>{s.r(d),s.d(d,{assets:()=>l,contentTitle:()=>c,default:()=>h,frontMatter:()=>i,metadata:()=>r,toc:()=>a});const r=JSON.parse('{"id":"getting-starter/database-structure","title":"Estrutura do Banco de Dados","description":"Vis\xe3o Geral","source":"@site/docs/getting-starter/database-structure.md","sourceDirName":"getting-starter","slug":"/getting-starter/database-structure","permalink":"/docs-sinpom/docs/getting-starter/database-structure","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"sidebar_position":3},"sidebar":"docSidebar","previous":{"title":"Arquitetura do Projeto","permalink":"/docs-sinpom/docs/getting-starter/project-structure"},"next":{"title":"Requisitos","permalink":"/docs-sinpom/docs/getting-starter/requirements"}}');var n=s(4848),t=s(8453);const i={sidebar_position:3},c="Estrutura do Banco de Dados",l={},a=[{value:"Vis\xe3o Geral",id:"vis\xe3o-geral",level:2},{value:"Tabelas Principais",id:"tabelas-principais",level:2},{value:"1. <strong><code>users</code></strong>: Gerencia detalhes da conta do usu\xe1rio",id:"1-users-gerencia-detalhes-da-conta-do-usu\xe1rio",level:3},{value:"2. <strong><code>documents</code></strong>: Tabela de documentos.",id:"2-documents-tabela-de-documentos",level:3},{value:"3. <strong><code>entity_people</code></strong>: Tabela de entidade de pessoas",id:"3-entity_people-tabela-de-entidade-de-pessoas",level:3},{value:"4. <strong><code>occurrences</code></strong>: Tabela de registro de ocorr\xeancias",id:"4-occurrences-tabela-de-registro-de-ocorr\xeancias",level:3},{value:"Principais Relacionamentos",id:"principais-relacionamentos",level:2},{value:"Relationamentos de <code>users</code>",id:"relationamentos-de-users",level:3},{value:"Relationamentos de <code>documents</code>",id:"relationamentos-de-documents",level:3},{value:"Exemplo de Consulta SQL",id:"exemplo-de-consulta-sql",level:2},{value:"Diagrama ER",id:"diagrama-er",level:2}];function o(e){const d={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",img:"img",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...(0,t.R)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(d.header,{children:(0,n.jsx)(d.h1,{id:"estrutura-do-banco-de-dados",children:"Estrutura do Banco de Dados"})}),"\n",(0,n.jsx)(d.h2,{id:"vis\xe3o-geral",children:"Vis\xe3o Geral"}),"\n",(0,n.jsx)(d.p,{children:"O banco de dados do SINPOM \xe9 a espinha dorsal do sistema, permitindo armazenamento e a recupera\xe7\xe3o de dados criticos da plataforma, incluindo contas de usu\xe1rios, fun\xe7\xf5es, logs de acesso e entidades espec\xedficas. Ele usa o MySQL como sgbd, e foi projetado para funcionar perfeitamente com o ORM do Laravel (Eloquent) e \xe9 estruturado para se alinhar \xe0 arquitetura MVC."}),"\n",(0,n.jsx)(d.h2,{id:"tabelas-principais",children:"Tabelas Principais"}),"\n",(0,n.jsxs)(d.h3,{id:"1-users-gerencia-detalhes-da-conta-do-usu\xe1rio",children:["1. ",(0,n.jsx)(d.strong,{children:(0,n.jsx)(d.code,{children:"users"})}),": Gerencia detalhes da conta do usu\xe1rio"]}),"\n",(0,n.jsxs)(d.table,{children:[(0,n.jsx)(d.thead,{children:(0,n.jsxs)(d.tr,{children:[(0,n.jsx)(d.th,{children:"Field Name"}),(0,n.jsx)(d.th,{children:"Data Type"}),(0,n.jsx)(d.th,{children:"Description"})]})}),(0,n.jsxs)(d.tbody,{children:[(0,n.jsxs)(d.tr,{children:[(0,n.jsx)(d.td,{children:"id"}),(0,n.jsx)(d.td,{children:"INT"}),(0,n.jsx)(d.td,{children:"Primary key, auto-increment."})]}),(0,n.jsxs)(d.tr,{children:[(0,n.jsx)(d.td,{children:"name"}),(0,n.jsx)(d.td,{children:"VARCHAR(255)"}),(0,n.jsx)(d.td,{children:"User's full name."})]}),(0,n.jsxs)(d.tr,{children:[(0,n.jsx)(d.td,{children:"email"}),(0,n.jsx)(d.td,{children:"VARCHAR(255)"}),(0,n.jsx)(d.td,{children:"Unique email address."})]}),(0,n.jsxs)(d.tr,{children:[(0,n.jsx)(d.td,{children:"email_verified_at"}),(0,n.jsx)(d.td,{children:"TIMESTAMP"}),(0,n.jsx)(d.td,{children:"Email verification timestamp."})]}),(0,n.jsxs)(d.tr,{children:[(0,n.jsx)(d.td,{children:"password"}),(0,n.jsx)(d.td,{children:"VARCHAR(255)"}),(0,n.jsx)(d.td,{children:"Encrypted password."})]}),(0,n.jsxs)(d.tr,{children:[(0,n.jsx)(d.td,{children:"remember_token"}),(0,n.jsx)(d.td,{children:"VARCHAR(100)"}),(0,n.jsx)(d.td,{})]}),(0,n.jsxs)(d.tr,{children:[(0,n.jsx)(d.td,{children:"google2fa_secret"}),(0,n.jsx)(d.td,{children:"VARCHAR(255)"}),(0,n.jsx)(d.td,{})]}),(0,n.jsxs)(d.tr,{children:[(0,n.jsx)(d.td,{children:"created_at"}),(0,n.jsx)(d.td,{children:"TIMESTAMP"}),(0,n.jsx)(d.td,{children:"Record creation timestamp."})]}),(0,n.jsxs)(d.tr,{children:[(0,n.jsx)(d.td,{children:"updated_at"}),(0,n.jsx)(d.td,{children:"TIMESTAMP"}),(0,n.jsx)(d.td,{children:"Record last update timestamp."})]})]})]}),"\n",(0,n.jsxs)(d.h3,{id:"2-documents-tabela-de-documentos",children:["2. ",(0,n.jsx)(d.strong,{children:(0,n.jsx)(d.code,{children:"documents"})}),": Tabela de documentos."]}),"\n",(0,n.jsxs)(d.table,{children:[(0,n.jsx)(d.thead,{children:(0,n.jsxs)(d.tr,{children:[(0,n.jsx)(d.th,{children:"Field Name"}),(0,n.jsx)(d.th,{children:"Data Type"}),(0,n.jsx)(d.th,{children:"Description"})]})}),(0,n.jsxs)(d.tbody,{children:[(0,n.jsxs)(d.tr,{children:[(0,n.jsx)(d.td,{children:"id"}),(0,n.jsx)(d.td,{children:"BIGINT unsigned"}),(0,n.jsx)(d.td,{children:"Primary key, auto-increment"})]}),(0,n.jsxs)(d.tr,{children:[(0,n.jsx)(d.td,{children:"document_kind_id"}),(0,n.jsx)(d.td,{children:"BIGINT unsigned"}),(0,n.jsx)(d.td,{children:"tipo do documento"})]}),(0,n.jsxs)(d.tr,{children:[(0,n.jsx)(d.td,{children:"staff_id"}),(0,n.jsx)(d.td,{children:"BIGINT unsigned"}),(0,n.jsx)(d.td,{children:"matricula do criador"})]}),(0,n.jsxs)(d.tr,{children:[(0,n.jsx)(d.td,{children:"rank_id"}),(0,n.jsx)(d.td,{children:"BIGINT unsigned"}),(0,n.jsx)(d.td,{children:"posto/graduacao do criador"})]}),(0,n.jsxs)(d.tr,{children:[(0,n.jsx)(d.td,{children:"opm_structure_id"}),(0,n.jsx)(d.td,{children:"BIGINT unsigned"}),(0,n.jsx)(d.td,{children:"se\xe7\xe3o do criador do documento"})]}),(0,n.jsxs)(d.tr,{children:[(0,n.jsx)(d.td,{children:"assinado_por"}),(0,n.jsx)(d.td,{children:"BIGINT unsigned"}),(0,n.jsx)(d.td,{children:"assinatura do documento finalizado"})]}),(0,n.jsxs)(d.tr,{children:[(0,n.jsx)(d.td,{children:"assinado_por_rank"}),(0,n.jsx)(d.td,{children:"BIGINT unsigned"}),(0,n.jsx)(d.td,{children:"assinatura do documento finalizado"})]}),(0,n.jsxs)(d.tr,{children:[(0,n.jsx)(d.td,{children:"reference_document_id"}),(0,n.jsx)(d.td,{children:"BIGINT unsigned"}),(0,n.jsx)(d.td,{children:"documento que deu origem a este"})]}),(0,n.jsxs)(d.tr,{children:[(0,n.jsx)(d.td,{children:"reply_document_id"}),(0,n.jsx)(d.td,{children:"BIGINT unsigned"}),(0,n.jsx)(d.td,{})]}),(0,n.jsxs)(d.tr,{children:[(0,n.jsx)(d.td,{children:"util_ate"}),(0,n.jsx)(d.td,{children:"DATE"}),(0,n.jsx)(d.td,{children:"prazo aceit\xe1vel do documento"})]}),(0,n.jsxs)(d.tr,{children:[(0,n.jsx)(d.td,{children:"conteudo"}),(0,n.jsx)(d.td,{children:"TEXT"}),(0,n.jsx)(d.td,{})]}),(0,n.jsxs)(d.tr,{children:[(0,n.jsx)(d.td,{children:"difundido"}),(0,n.jsx)(d.td,{children:"TINYINT(1)"}),(0,n.jsx)(d.td,{})]}),(0,n.jsxs)(d.tr,{children:[(0,n.jsx)(d.td,{children:"bloqueio_sap"}),(0,n.jsx)(d.td,{children:"TINYINT(1)"}),(0,n.jsx)(d.td,{})]}),(0,n.jsxs)(d.tr,{children:[(0,n.jsx)(d.td,{children:"assunto"}),(0,n.jsx)(d.td,{children:"VARCHAR(191)"}),(0,n.jsx)(d.td,{})]}),(0,n.jsxs)(d.tr,{children:[(0,n.jsx)(d.td,{children:"referencias"}),(0,n.jsx)(d.td,{children:"VARCHAR(191)"}),(0,n.jsx)(d.td,{})]}),(0,n.jsxs)(d.tr,{children:[(0,n.jsx)(d.td,{children:"created_at"}),(0,n.jsx)(d.td,{children:"TIMESTAMP"}),(0,n.jsx)(d.td,{children:"Record creation timestamp."})]}),(0,n.jsxs)(d.tr,{children:[(0,n.jsx)(d.td,{children:"updated_at"}),(0,n.jsx)(d.td,{children:"TIMESTAMP"}),(0,n.jsx)(d.td,{children:"Record last update timestamp."})]})]})]}),"\n",(0,n.jsxs)(d.h3,{id:"3-entity_people-tabela-de-entidade-de-pessoas",children:["3. ",(0,n.jsx)(d.strong,{children:(0,n.jsx)(d.code,{children:"entity_people"})}),": Tabela de entidade de pessoas"]}),"\n",(0,n.jsxs)(d.table,{children:[(0,n.jsx)(d.thead,{children:(0,n.jsxs)(d.tr,{children:[(0,n.jsx)(d.th,{children:"Field Name"}),(0,n.jsx)(d.th,{children:"Data Type"}),(0,n.jsx)(d.th,{children:"Description"})]})}),(0,n.jsxs)(d.tbody,{children:[(0,n.jsxs)(d.tr,{children:[(0,n.jsx)(d.td,{children:"id"}),(0,n.jsx)(d.td,{children:"BIGINT unsigned"}),(0,n.jsx)(d.td,{children:"Primary key, auto-increment."})]}),(0,n.jsxs)(d.tr,{children:[(0,n.jsx)(d.td,{children:"nome"}),(0,n.jsx)(d.td,{children:"VARCHAR(191)"}),(0,n.jsx)(d.td,{children:"Name of the person."})]}),(0,n.jsxs)(d.tr,{children:[(0,n.jsx)(d.td,{children:"pai"}),(0,n.jsx)(d.td,{children:"VARCHAR(191)"}),(0,n.jsx)(d.td,{children:"Father's name."})]}),(0,n.jsxs)(d.tr,{children:[(0,n.jsx)(d.td,{children:"mae"}),(0,n.jsx)(d.td,{children:"VARCHAR(191)"}),(0,n.jsx)(d.td,{children:"Mother's name."})]}),(0,n.jsxs)(d.tr,{children:[(0,n.jsx)(d.td,{children:"apelido"}),(0,n.jsx)(d.td,{children:"VARCHAR(191)"}),(0,n.jsx)(d.td,{children:"Nickname of the person."})]}),(0,n.jsxs)(d.tr,{children:[(0,n.jsx)(d.td,{children:"profissao"}),(0,n.jsx)(d.td,{children:"VARCHAR(191)"}),(0,n.jsx)(d.td,{children:"Profession of the person."})]}),(0,n.jsxs)(d.tr,{children:[(0,n.jsx)(d.td,{children:"staff_id"}),(0,n.jsx)(d.td,{children:"BIGINT"}),(0,n.jsx)(d.td,{children:"Reference to staff."})]}),(0,n.jsxs)(d.tr,{children:[(0,n.jsx)(d.td,{children:"opm_id"}),(0,n.jsx)(d.td,{children:"BIGINT unsigned"}),(0,n.jsx)(d.td,{children:"Reference to OPM."})]}),(0,n.jsxs)(d.tr,{children:[(0,n.jsx)(d.td,{children:"entity_people_situacao_funcional_id"}),(0,n.jsx)(d.td,{children:"BIGINT"}),(0,n.jsx)(d.td,{children:"Functional situation reference."})]}),(0,n.jsxs)(d.tr,{children:[(0,n.jsx)(d.td,{children:"entity_people_involved_status_id"}),(0,n.jsx)(d.td,{children:"BIGINT"}),(0,n.jsx)(d.td,{children:"Involved status reference."})]}),(0,n.jsxs)(d.tr,{children:[(0,n.jsx)(d.td,{children:"gender_id"}),(0,n.jsx)(d.td,{children:"BIGINT"}),(0,n.jsx)(d.td,{children:"Gender reference."})]}),(0,n.jsxs)(d.tr,{children:[(0,n.jsx)(d.td,{children:"entity_people_color_id"}),(0,n.jsx)(d.td,{children:"BIGINT"}),(0,n.jsx)(d.td,{children:"Color reference."})]}),(0,n.jsxs)(d.tr,{children:[(0,n.jsx)(d.td,{children:"entity_people_priority_level_id"}),(0,n.jsx)(d.td,{children:"BIGINT"}),(0,n.jsx)(d.td,{children:"Priority level reference."})]}),(0,n.jsxs)(d.tr,{children:[(0,n.jsx)(d.td,{children:"data_de_nascimento"}),(0,n.jsx)(d.td,{children:"DATE"}),(0,n.jsx)(d.td,{children:"Date of birth."})]}),(0,n.jsxs)(d.tr,{children:[(0,n.jsx)(d.td,{children:"em_servico"}),(0,n.jsx)(d.td,{children:"TINYINT"}),(0,n.jsx)(d.td,{children:"Indicates if on service."})]}),(0,n.jsxs)(d.tr,{children:[(0,n.jsx)(d.td,{children:"created_at"}),(0,n.jsx)(d.td,{children:"TIMESTAMP"}),(0,n.jsx)(d.td,{children:"Record creation timestamp."})]}),(0,n.jsxs)(d.tr,{children:[(0,n.jsx)(d.td,{children:"updated_at"}),(0,n.jsx)(d.td,{children:"TIMESTAMP"}),(0,n.jsx)(d.td,{children:"Last update timestamp."})]}),(0,n.jsxs)(d.tr,{children:[(0,n.jsx)(d.td,{children:"weapon_kind_id"}),(0,n.jsx)(d.td,{children:"BIGINT unsigned"}),(0,n.jsx)(d.td,{children:"Reference to weapon kind."})]}),(0,n.jsxs)(d.tr,{children:[(0,n.jsx)(d.td,{children:"lesoes_multiplas"}),(0,n.jsx)(d.td,{children:"TINYINT"}),(0,n.jsx)(d.td,{children:"Indicates multiple injuries."})]}),(0,n.jsxs)(d.tr,{children:[(0,n.jsx)(d.td,{children:"cpf"}),(0,n.jsx)(d.td,{children:"VARCHAR(191)"}),(0,n.jsx)(d.td,{children:"CPF number."})]}),(0,n.jsxs)(d.tr,{children:[(0,n.jsx)(d.td,{children:"rg"}),(0,n.jsx)(d.td,{children:"VARCHAR(191)"}),(0,n.jsx)(d.td,{children:"RG number."})]}),(0,n.jsxs)(d.tr,{children:[(0,n.jsx)(d.td,{children:"created_by_staff_id"}),(0,n.jsx)(d.td,{children:"BIGINT unsigned"}),(0,n.jsx)(d.td,{children:"Staff ID who created the record."})]}),(0,n.jsxs)(d.tr,{children:[(0,n.jsx)(d.td,{children:"PRIMARY KEY"}),(0,n.jsx)(d.td,{children:"ID"}),(0,n.jsx)(d.td,{children:"Primary key of the table."})]}),(0,n.jsxs)(d.tr,{children:[(0,n.jsx)(d.td,{children:"FOREIGN KEY (created_by_staff_id)"}),(0,n.jsx)(d.td,{children:"STAFF(ID)"}),(0,n.jsxs)(d.td,{children:["References ",(0,n.jsx)(d.code,{children:"staff"})," table."]})]}),(0,n.jsxs)(d.tr,{children:[(0,n.jsx)(d.td,{children:"FOREIGN KEY (opm_id)"}),(0,n.jsx)(d.td,{children:"OPMS(ID)"}),(0,n.jsxs)(d.td,{children:["References ",(0,n.jsx)(d.code,{children:"opms"})," table."]})]})]})]}),"\n",(0,n.jsxs)(d.h3,{id:"4-occurrences-tabela-de-registro-de-ocorr\xeancias",children:["4. ",(0,n.jsx)(d.strong,{children:(0,n.jsx)(d.code,{children:"occurrences"})}),": Tabela de registro de ocorr\xeancias"]}),"\n",(0,n.jsxs)(d.table,{children:[(0,n.jsx)(d.thead,{children:(0,n.jsxs)(d.tr,{children:[(0,n.jsx)(d.th,{children:"Field Name"}),(0,n.jsx)(d.th,{children:"Data Type"}),(0,n.jsx)(d.th,{children:"Description"})]})}),(0,n.jsxs)(d.tbody,{children:[(0,n.jsxs)(d.tr,{children:[(0,n.jsx)(d.td,{children:"id"}),(0,n.jsx)(d.td,{children:"BIGINT unsigned"}),(0,n.jsx)(d.td,{children:"Primary key, auto-increment."})]}),(0,n.jsxs)(d.tr,{children:[(0,n.jsx)(d.td,{children:"city_id"}),(0,n.jsx)(d.td,{children:"BIGINT unsigned"}),(0,n.jsx)(d.td,{children:"Reference to the city."})]}),(0,n.jsxs)(d.tr,{children:[(0,n.jsx)(d.td,{children:"opm_id"}),(0,n.jsx)(d.td,{children:"BIGINT unsigned"}),(0,n.jsx)(d.td,{children:"Reference to the OPM."})]}),(0,n.jsxs)(d.tr,{children:[(0,n.jsx)(d.td,{children:"staff_id"}),(0,n.jsx)(d.td,{children:"BIGINT unsigned"}),(0,n.jsx)(d.td,{children:"Staff who registered the occurrence."})]}),(0,n.jsxs)(d.tr,{children:[(0,n.jsx)(d.td,{children:"rank_id"}),(0,n.jsx)(d.td,{children:"BIGINT unsigned"}),(0,n.jsx)(d.td,{children:"Rank of the staff who registered the occurrence."})]}),(0,n.jsxs)(d.tr,{children:[(0,n.jsx)(d.td,{children:"endereco"}),(0,n.jsx)(d.td,{children:"VARCHAR(191)"}),(0,n.jsx)(d.td,{children:"Address of the occurrence."})]}),(0,n.jsxs)(d.tr,{children:[(0,n.jsx)(d.td,{children:"bairro"}),(0,n.jsx)(d.td,{children:"VARCHAR(191)"}),(0,n.jsx)(d.td,{children:"Neighborhood where the occurrence happened."})]}),(0,n.jsxs)(d.tr,{children:[(0,n.jsx)(d.td,{children:"ponto_de_referencia"}),(0,n.jsx)(d.td,{children:"VARCHAR(191)"}),(0,n.jsx)(d.td,{children:"Reference point for the occurrence location."})]}),(0,n.jsxs)(d.tr,{children:[(0,n.jsx)(d.td,{children:"num_ocorrencia"}),(0,n.jsx)(d.td,{children:"VARCHAR(191)"}),(0,n.jsx)(d.td,{children:"Occurrence number."})]}),(0,n.jsxs)(d.tr,{children:[(0,n.jsx)(d.td,{children:"data"}),(0,n.jsx)(d.td,{children:"DATE"}),(0,n.jsx)(d.td,{children:"Date of the occurrence."})]}),(0,n.jsxs)(d.tr,{children:[(0,n.jsx)(d.td,{children:"hora"}),(0,n.jsx)(d.td,{children:"TIME"}),(0,n.jsx)(d.td,{children:"Time of the occurrence."})]}),(0,n.jsxs)(d.tr,{children:[(0,n.jsx)(d.td,{children:"objetos"}),(0,n.jsx)(d.td,{children:"TEXT"}),(0,n.jsx)(d.td,{children:"Objects involved in the occurrence."})]}),(0,n.jsxs)(d.tr,{children:[(0,n.jsx)(d.td,{children:"descricao"}),(0,n.jsx)(d.td,{children:"TEXT"}),(0,n.jsx)(d.td,{children:"Description of the occurrence."})]}),(0,n.jsxs)(d.tr,{children:[(0,n.jsx)(d.td,{children:"created_at"}),(0,n.jsx)(d.td,{children:"TIMESTAMP"}),(0,n.jsx)(d.td,{children:"Record creation timestamp."})]}),(0,n.jsxs)(d.tr,{children:[(0,n.jsx)(d.td,{children:"updated_at"}),(0,n.jsx)(d.td,{children:"TIMESTAMP"}),(0,n.jsx)(d.td,{children:"Last update timestamp."})]}),(0,n.jsxs)(d.tr,{children:[(0,n.jsx)(d.td,{children:"opm_area"}),(0,n.jsx)(d.td,{children:"BIGINT"}),(0,n.jsx)(d.td,{children:"Reference to the OPM area."})]}),(0,n.jsxs)(d.tr,{children:[(0,n.jsx)(d.td,{children:"occurrence_id_motivadora"}),(0,n.jsx)(d.td,{children:"BIGINT"}),(0,n.jsx)(d.td,{children:"Reference to motivating occurrence."})]}),(0,n.jsxs)(d.tr,{children:[(0,n.jsx)(d.td,{children:"pode_gerar_desdobramentos"}),(0,n.jsx)(d.td,{children:"TEXT"}),(0,n.jsx)(d.td,{children:"Indicates if the occurrence can generate follow-ups."})]}),(0,n.jsxs)(d.tr,{children:[(0,n.jsx)(d.td,{children:"motivacao_id"}),(0,n.jsx)(d.td,{children:"BIGINT"}),(0,n.jsx)(d.td,{children:"Reference to the occurrence motivation."})]}),(0,n.jsxs)(d.tr,{children:[(0,n.jsx)(d.td,{children:"faccao_id"}),(0,n.jsx)(d.td,{children:"BIGINT"}),(0,n.jsx)(d.td,{children:"Reference to the faction involved."})]}),(0,n.jsxs)(d.tr,{children:[(0,n.jsx)(d.td,{children:"zona_id"}),(0,n.jsx)(d.td,{children:"BIGINT unsigned"}),(0,n.jsx)(d.td,{children:"Reference to the zone."})]}),(0,n.jsxs)(d.tr,{children:[(0,n.jsx)(d.td,{children:"vehicle_kind_id"}),(0,n.jsx)(d.td,{children:"BIGINT unsigned"}),(0,n.jsx)(d.td,{children:"Reference to the kind of vehicle involved."})]}),(0,n.jsxs)(d.tr,{children:[(0,n.jsx)(d.td,{children:"staff_id_registro"}),(0,n.jsx)(d.td,{children:"BIGINT unsigned"}),(0,n.jsx)(d.td,{children:"Reference to the staff who recorded the occurrence."})]}),(0,n.jsxs)(d.tr,{children:[(0,n.jsx)(d.td,{children:"pm_ameacado"}),(0,n.jsx)(d.td,{children:"TINYINT"}),(0,n.jsx)(d.td,{children:"Indicates if a police officer was threatened."})]}),(0,n.jsxs)(d.tr,{children:[(0,n.jsx)(d.td,{children:"meios_ameaca_id"}),(0,n.jsx)(d.td,{children:"BIGINT"}),(0,n.jsx)(d.td,{children:"Reference to the means of threat."})]}),(0,n.jsxs)(d.tr,{children:[(0,n.jsx)(d.td,{children:"meio_ameaca_descricao"}),(0,n.jsx)(d.td,{children:"VARCHAR(191)"}),(0,n.jsx)(d.td,{children:"Description of the threat means."})]}),(0,n.jsxs)(d.tr,{children:[(0,n.jsx)(d.td,{children:"providencia_adotada"}),(0,n.jsx)(d.td,{children:"VARCHAR(191)"}),(0,n.jsx)(d.td,{children:"Adopted measures regarding the occurrence."})]}),(0,n.jsxs)(d.tr,{children:[(0,n.jsx)(d.td,{children:"situacao_id"}),(0,n.jsx)(d.td,{children:"BIGINT unsigned"}),(0,n.jsx)(d.td,{children:"Reference to the occurrence situation."})]}),(0,n.jsxs)(d.tr,{children:[(0,n.jsx)(d.td,{children:"modalidade_id"}),(0,n.jsx)(d.td,{children:"BIGINT unsigned"}),(0,n.jsx)(d.td,{children:"Reference to the occurrence modality."})]}),(0,n.jsxs)(d.tr,{children:[(0,n.jsx)(d.td,{children:"estabelecimento_comercial_id"}),(0,n.jsx)(d.td,{children:"BIGINT unsigned"}),(0,n.jsx)(d.td,{children:"Reference to a commercial establishment."})]}),(0,n.jsxs)(d.tr,{children:[(0,n.jsx)(d.td,{children:"instituicao_financeira_id"}),(0,n.jsx)(d.td,{children:"BIGINT unsigned"}),(0,n.jsx)(d.td,{children:"Reference to a financial institution."})]}),(0,n.jsxs)(d.tr,{children:[(0,n.jsx)(d.td,{children:"nome_estabelecimento"}),(0,n.jsx)(d.td,{children:"VARCHAR(191)"}),(0,n.jsx)(d.td,{children:"Name of the commercial establishment."})]}),(0,n.jsxs)(d.tr,{children:[(0,n.jsx)(d.td,{children:"meio_empregado_inst_finan_id"}),(0,n.jsx)(d.td,{children:"BIGINT unsigned"}),(0,n.jsx)(d.td,{children:"Reference to the means used at the financial institution."})]}),(0,n.jsxs)(d.tr,{children:[(0,n.jsx)(d.td,{children:"finalizada"}),(0,n.jsx)(d.td,{children:"TINYINT"}),(0,n.jsx)(d.td,{children:"Indicates if the occurrence is finalized."})]}),(0,n.jsxs)(d.tr,{children:[(0,n.jsx)(d.td,{children:"PRIMARY KEY"}),(0,n.jsx)(d.td,{children:"ID"}),(0,n.jsx)(d.td,{children:"Primary key of the table."})]}),(0,n.jsxs)(d.tr,{children:[(0,n.jsx)(d.td,{children:"FOREIGN KEY (opm_id)"}),(0,n.jsx)(d.td,{children:"OPMS(ID)"}),(0,n.jsxs)(d.td,{children:["References the ",(0,n.jsx)(d.code,{children:"opms"})," table."]})]}),(0,n.jsxs)(d.tr,{children:[(0,n.jsx)(d.td,{children:"FOREIGN KEY (staff_id)"}),(0,n.jsx)(d.td,{children:"STAFF(ID)"}),(0,n.jsxs)(d.td,{children:["References the ",(0,n.jsx)(d.code,{children:"staff"})," table."]})]}),(0,n.jsxs)(d.tr,{children:[(0,n.jsx)(d.td,{children:"FOREIGN KEY (rank_id)"}),(0,n.jsx)(d.td,{children:"RANKS(ID)"}),(0,n.jsxs)(d.td,{children:["References the ",(0,n.jsx)(d.code,{children:"ranks"})," table."]})]})]})]}),"\n",(0,n.jsx)(d.h2,{id:"principais-relacionamentos",children:"Principais Relacionamentos"}),"\n",(0,n.jsxs)(d.h3,{id:"relationamentos-de-users",children:["Relationamentos de ",(0,n.jsx)(d.code,{children:"users"})]}),"\n",(0,n.jsx)(d.p,{children:(0,n.jsx)(d.img,{alt:"Diagrama relacionamento Users",src:s(4240).A+"",width:"952",height:"1089"})}),"\n",(0,n.jsxs)(d.h3,{id:"relationamentos-de-documents",children:["Relationamentos de ",(0,n.jsx)(d.code,{children:"documents"})]}),"\n",(0,n.jsx)(d.p,{children:(0,n.jsx)(d.img,{alt:"Diagrama relacionamento Documents",src:s(5770).A+"",width:"879",height:"1024"})}),"\n",(0,n.jsx)(d.h2,{id:"exemplo-de-consulta-sql",children:"Exemplo de Consulta SQL"}),"\n",(0,n.jsx)(d.p,{children:"Lista todos os agentes de uma OPM ou de um CPR"}),"\n",(0,n.jsx)(d.pre,{children:(0,n.jsx)(d.code,{className:"language-sql",children:"   $user = Auth::user();\n      $opm = Opm::find($request->opm_id);\n      $isCpr = $opm ? $opm->grande_comando : null;\n      $agentsQuery = User::join('staff', 'users.staff_id','=','staff.id')\n         ->leftJoin('agent_request_for_inclusions', 'agent_request_for_inclusions.staff_id', '=', 'staff.id')\n         ->join('opms','opms.id', '=', 'staff.opm_id')\n         ->join('model_has_roles','users.id','=','model_has_roles.model_id')\n         ->join('ranks','staff.rank_id','=','ranks.id')\n         ->join('roles', 'roles.id', '=', 'model_has_roles.role_id')\n         ->whereNotIn('roles.name', ['Comandante - OPM', 'Subcomandante - OPM', 'Comandante - CPR', 'Subcomandante - CPR'])\n         ->when(($request->opm_id == $user->staff->opm_id) and ($isCpr), function($q) use ($request){\n            $q->where('opms.cpr_id', $request->opm_id);\n         })\n         ->when($request->opm_id, function($q) use ($request){\n            $q->where('staff.opm_id',$request->opm_id);\n         })\n         ->when(!$request->opm_id and $user->hasAnyPermission(['Consultar agentes OPM']), function($q) use ($user){\n            $q->where('staff.opm_id',$user->staff->opm_id);\n         })\n         ->when(($request->staff_id) and $user->hasAnyPermission(['Consultar agentes OPM']), function($q) use ($request, $user){\n            $q->where('staff.opm_id',$user->staff->opm_id)\n            ->where('users.id', Crypt::decrypt($request->staff_id));\n         })\n         ->when(!$request->opm_id and $user->hasAnyPermission(['Consultar agentes CPR']), function($q) use ($user){\n            $q->where('opms.cpr_id', $user->staff->opm->cpr_id);\n         })\n         ->when(($request->staff_id) and $user->hasAnyPermission(['Consultar agentes CPR']), function($q) use ($request, $user){\n            $q->where('opms.cpr_id', $user->staff->opm->cpr_id)\n            ->where('users.id', Crypt::decrypt($request->staff_id));\n         })\n         ->when(($request->staff_id) and $user->hasAnyPermission(['Ver todos agentes']), function($q) use ($request, $user){\n            $q->where('users.id', Crypt::decrypt($request->staff_id));\n         })->groupBy('staff.id');\n      $agentsCountByRank = $agentsQuery->select('users.*')->orderBy('ranks.nivel')->get()->countBy('staff.rank.rank');\n      $agents = $agentsQuery->select('users.*')->orderBy('ranks.nivel')->orderBy('staff.id')->paginate(50);\n"})}),"\n",(0,n.jsx)(d.h2,{id:"diagrama-er",children:"Diagrama ER"}),"\n",(0,n.jsx)(d.p,{children:(0,n.jsx)(d.img,{alt:"Diagrama ER",src:s(1632).A+"",width:"2833",height:"14650"})})]})}function h(e={}){const{wrapper:d}={...(0,t.R)(),...e.components};return d?(0,n.jsx)(d,{...e,children:(0,n.jsx)(o,{...e})}):o(e)}},5770:(e,d,s)=>{s.d(d,{A:()=>r});const r=s.p+"assets/images/documents_relationship-7540f4a724ed6efb46c5393614f3836a.png"},1632:(e,d,s)=>{s.d(d,{A:()=>r});const r=s.p+"assets/images/er-diagram-fca9e48359b73eb86cebd64da4cbf718.png"},4240:(e,d,s)=>{s.d(d,{A:()=>r});const r=s.p+"assets/images/users_relationship-e07b13721aebc46cfcc4bd370b4cd089.png"},8453:(e,d,s)=>{s.d(d,{R:()=>i,x:()=>c});var r=s(6540);const n={},t=r.createContext(n);function i(e){const d=r.useContext(t);return r.useMemo((function(){return"function"==typeof e?e(d):{...d,...e}}),[d,e])}function c(e){let d;return d=e.disableParentContext?"function"==typeof e.components?e.components(n):e.components||n:i(e.components),r.createElement(t.Provider,{value:d},e.children)}}}]);